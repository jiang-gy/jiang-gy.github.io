<hr>
<h2 id="title-Ns3Trace系统总结date-2024-02-01-09-29-35tags-网络仿真"><a href="#title-Ns3Trace系统总结date-2024-02-01-09-29-35tags-网络仿真" class="headerlink" title="title: Ns3Trace系统总结date: 2024-02-01 09:29:35tags: - 网络仿真"></a>title: Ns3Trace系统总结<br>date: 2024-02-01 09:29:35<br>tags:<br> - 网络仿真</h2><h1 id="Ns3-Trace系统"><a href="#Ns3-Trace系统" class="headerlink" title="Ns3 Trace系统"></a>Ns3 Trace系统</h1><h2 id="Trace变量配置"><a href="#Trace变量配置" class="headerlink" title="Trace变量配置"></a>Trace变量配置</h2><p>​	由于Ns3初始化并没有提供Trace变量的初始值，创建变量时无法根据配置好的函数指针初始化Trace变量，因此只能在已存在的C++对象上配置Trace变量。</p>
<p>​	在对象未创建、未分配内存时，Trace变量是无法配置的，即使配置相关属性，也不能成功使用。因此，Trace变量的配置操作必须放在网络拓扑用户应用建立完成之后，但必须放在<code>Simulation::Run()</code>之前。为保证每次成功配置并成功运行，十分建议养成在<strong>程序末尾配置Trace + 开启仿真运行的习惯</strong>。</p>
<h3 id="1-ipv4-l3-protocol发送数据包"><a href="#1-ipv4-l3-protocol发送数据包" class="headerlink" title="1. ipv4-l3-protocol发送数据包"></a>1. ipv4-l3-protocol发送数据包</h3><pre><code class="cpp">//src/internet/model/ipv4-l3-protocol.cc
TypeId 
Ipv4L3Protocol::GetTypeId (void)
{
    ...
    .AddTraceSource (&quot;TxTrace&quot;,
                     &quot;Send ipv4 packet to outgoing interface.&quot;,
                     MakeTraceSourceAccessor (&amp;Ipv4L3Protocol::m_adTrace),
                     &quot;ns3::Ipv4L3Protocol::AdressCallback&quot;)
    ...
}


void
Ipv4L3Protocol::CallTxTrace (const Ipv4Header &amp; ipHeader, Ptr&lt;Packet&gt; packet,
                                    Ptr&lt;Ipv4&gt; ipv4, uint32_t interface)
{
  Ptr&lt;Packet&gt; packetCopy = packet-&gt;Copy ();
  packetCopy-&gt;AddHeader (ipHeader);
  m_txTrace (packetCopy, ipv4, interface);
}

//src/internet/model/ipv4-l3-protocol.h
...
  // The following two traces pass a packet with an IP header
  /// Trace of transmitted packets
  /// \deprecated The non-const \c Ptr&lt;Ipv4&gt; argument is deprecated
  /// and will be changed to \c Ptr&lt;const Ipv4&gt; in a future release.
  TracedCallback&lt;Ptr&lt;const Packet&gt;, Ptr&lt;Ipv4&gt;,  uint32_t&gt; m_txTrace;
...
</code></pre>
